# run silva reformat and take .uplift .fasta.clean and .taxid outputs
# run make otu script
# run clean fasta script

# run mapseq clustering

# rename files

# -------------------------------------------------------------
# Chris edits

# perl /hps/software/users/rdf/metagenomics/service-team/users/chrisata/scripts_taxdb_nf/old_scripts_taxdb/silva-reformat.pl -v 132 --out /hps/nobackup/rdf/metagenomics/service-team/users/chrisata/silva_ssu-20200130-recreation/v132/

# Doing this before make_otu_file.py
# That will remove empty phyla
# grep -v "p__;" SILVA_132_SSURef_tax_silva_trunc.fasta.uplift > SILVA_132_SSURef_tax_silva_trunc.fasta.uplift.filt_phyla

# python /hps/software/users/rdf/metagenomics/service-team/users/chrisata/scripts_taxdb_nf/old_scripts_taxdb/make_otu_file.py

# Replaced clean_fasta.py with seqktk command:
# grep -v '^#' SILVA_132_SSURef_tax_silva_trunc.fasta.uplift.filt_phyla | cut -f1 > SILVA_132_SSURef_tax_silva_trunc.fasta.uplift.idlst
# singularity exec /hps/nobackup/rdf/metagenomics/service-team/singularity-cache/quay.io_biocontainers_seqtk:1.3.sif seqtk subseq SILVA_132_SSURef_tax_silva_trunc.fasta.clean SILVA_132_SSURef_tax_silva_trunc.fasta.uplift.idlst > SILVA_132_SSURef_tax_silva_trunc.fasta.clean.matched

# Mapseq cluster
# singularity exec /hps/nobackup/rdf/metagenomics/service-team/singularity-cache/quay.io-biocontainers-mapseq-2.1.1--ha34dc8c_0.img mapseq -nthreads 16 -tophits 80 -topotus 40 -outfmt simple dummy.fasta SSU.fasta slv_ssu_filtered2.txt
